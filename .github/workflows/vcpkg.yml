name: vcpkg
# cmake build of tesseract and training tools using vcpkg.
# Building training tools without sw is not supported on windows with cmake.
# Build stable version 4.1.1. 
# Requested port update https://github.com/microsoft/vcpkg/issues/16019.
# macos failing for leptonica
on:
  push:
  schedule:
    - cron: 0 0 2 3 *
jobs: 
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, windows-latest]
      
    steps:
    - uses: actions/checkout@v2
      with:
        submodules: recursive
    
    - name: Checkout vcpkg
      run: |
           git clone https://github.com/microsoft/vcpkg
    
    - name: Install vcpkg (Linux)
      run: |
           vcpkg/bootstrap-vcpkg.sh
           vcpkg/vcpkg integrate install
           vcpkg/vcpkg list tess
      if: runner.os == 'Linux'
    
    - name: Build Tesseract 4.1.1 (Linux)
      run: |
           vcpkg/vcpkg install leptonica:x64-linux tesseract:x64-linux
      if: runner.os == 'Linux'
    
    - name: Build baseapitest (Linux)
      run: |
           mkdir test-build && cd test-build
           cmake ../cmaketest 
           cmake --build . 
           ./basicapitest
      if: runner.os == 'Linux'
    
    - name: Install vcpkg (Windows)
      run: |
           vcpkg/bootstrap-vcpkg.bat
           vcpkg/vcpkg integrate install
           vcpkg/vcpkg list tess
      if: runner.os == 'Windows'

    - name: Build Tesseract 4.1.1 (Windows)
      run: |
           vcpkg/vcpkg install tesseract:x64-windows
      if: runner.os == 'Windows'
      
      
###    - name: Install vcpkg (macOS)
###      run: |
###           vcpkg/bootstrap-vcpkg.sh
###           vcpkg/vcpkg integrate install
###           vcpkg/vcpkg list tess
###      if: runner.os == 'macOS'
###    
###    - name: Build Tesseract 4.1.1 (macOS)
###      run: |
###           vcpkg/vcpkg install tesseract:x64-osx
###      if: runner.os == 'macOS'
### 
###    - name: Build baseapitest (macOS)
###      run: |
###           mkdir test-build && cd test-build
###           cmake ../cmaketest 
###           cmake --build . 
###           ./basicapitest
###      if: runner.os == 'macOS'
###      continue-on-error: true